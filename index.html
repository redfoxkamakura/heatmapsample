<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps API v3 HeatmapLayerの技術検証</title>
    <meta charset="utf-8"/>
    <!-- bin/jquery.slider.min.css -->
    <link rel="stylesheet" href="css/jslider.css" type="text/css">
    <link rel="stylesheet" href="css/jslider.blue.css" type="text/css">
    <link rel="stylesheet" href="css/jslider.plastic.css" type="text/css">
    <link rel="stylesheet" href="css/jslider.round.css" type="text/css">
    <link rel="stylesheet" href="css/jslider.round.plastic.css" type="text/css">
    <!-- end -->

    <script type="text/javascript" src="js/jquery-1.7.1.js"></script>

    <!-- bin/jquery.slider.min.js -->
    <script type="text/javascript" src="js/jshashtable-2.1_src.js"></script>
    <script type="text/javascript" src="js/jquery.numberformatter-1.2.3.js"></script>
    <script type="text/javascript" src="js/tmpl.js"></script>
    <script type="text/javascript" src="js/jquery.dependClass-0.1.js"></script>
    <script type="text/javascript" src="js/draggable-0.1.js"></script>
    <script type="text/javascript" src="js/jquery.slider.js"></script>
    <!-- end -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&v=3&language=ja&libraries=visualization"></script>
    <script type="text/javascript">

      // 各会社のスポット座標
      var company = {
        pos1: [35.6195, 139.6117],
        pos2: [35.6295, 139.6217],
        pos3: [35.6395, 139.6317],
        pos4: [35.6495, 139.6417],
        pos5: [35.6595, 139.6517]
      }

      // data
      // 　要素名：YYYYMMDD_営業マンx_地点x
      // 　要素　：pos　地点の座標
      //　　　　　：num　滞在していた時間(minues)
      var data = {};

      // 営業マン1の20140401の行動履歴
      data['20140401_1_1'] = {pos: company['pos1'], time_m: 60};
      data['20140401_1_4'] = {pos: company['pos4'], time_m: 30};

      // 営業マン1の20140402の行動履歴
      data['20140402_1_1'] = {pos: company['pos1'], time_m: 60};
      data['20140402_1_3'] = {pos: company['pos3'], time_m: 90};
      data['20140402_1_4'] = {pos: company['pos4'], time_m: 30};

      // 営業マン1の20140403の行動履歴
      data['20140403_1_1'] = {pos: company['pos1'], time_m: 60};
      data['20140403_1_2'] = {pos: company['pos2'], time_m: 10};
      data['20140403_1_3'] = {pos: company['pos3'], time_m: 90};
      data['20140403_1_4'] = {pos: company['pos4'], time_m: 30};

      // 営業マン1の20140404の行動履歴
      data['20140404_1_2'] = {pos: company['pos2'], time_m: 10};
      data['20140404_1_3'] = {pos: company['pos3'], time_m: 90};

      // 営業マン1の20140405の行動履歴
      data['20140405_1_1'] = {pos: company['pos1'], time_m: 60};
      data['20140405_1_5'] = {pos: company['pos5'], time_m: 5};


      // 営業マン1の20140405の行動履歴
      data['20140406_1_1'] = {pos: company['pos1'], time_m: 60};
      data['20140406_1_5'] = {pos: company['pos5'], time_m: 5};

      // 営業マン1の20140405の行動履歴
      data['20140407_1_1'] = {pos: company['pos1'], time_m: 60};


      var mapCanvas;
      var heatmap;
      var marker;
      var bounds;

      function initialize() {

          if (from === null || to === null) {
            var pos = new google.maps.LatLng(data[key].pos[0], data[key].pos[1]);
            heatmapData.push({
              location: pos,
              weight: data[key].time_m
            });            
            bounds.extend(pos);
          } else {
            if (from <= dateBefore && dateBefore <= to) {
              var pos = new google.maps.LatLng(data[key].pos[0], data[key].pos[1]);
              heatmapData.push({
                location: pos,
                weight: data[key].time_m
              });
              bounds.extend(pos);
            }
          }
        }
        
        heatmap = new google.maps.visualization.HeatmapLayer();
        heatmap.setData(heatmapData);
        heatmap.set('radius', 40);
        heatmap.setMap(mapCanvas);
      }
  </body>
</html>

